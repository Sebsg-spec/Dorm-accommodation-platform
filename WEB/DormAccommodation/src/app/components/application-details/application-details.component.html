<div class="component">
  <app-header-parameterized [hasUserLoginCard]="true"></app-header-parameterized>
  <div class="content">
    <div *ngIf="loading" class="loading">
      <p>Se încarcă detaliile dosarului...</p>
    </div>
    <div *ngIf="errorMessage" class="error">
      <p>{{ errorMessage }}</p>
    </div>
    <div *ngIf="!loading && !errorMessage && application" class="application-details">
      <h2>Detalii Dosar</h2>
      <div class="details-card">
        <p><strong>Nr. înregistrare:</strong> {{ application.applicationName }}</p>
        <p><strong>Nume student:</strong> {{ application.studentName }}</p>
        <p><strong>Facultate:</strong> {{ application.faculty }}</p>
        <p><strong>An:</strong> {{ application.year }}</p>
        <p><strong>Ultima actualizare:</strong> {{ application.lastUpdate | date:'dd/MM/yyyy HH:mm' }}</p>
        <p><strong>Status:</strong> {{ application.status.name }}</p>
        <p><strong>Comentariu:</strong> {{ application.comment || 'Niciun comentariu' }}</p>
        <p><strong>Cămin alocat:</strong> {{ application.assignedDorm ? application.assignedDorm : 'Nealocat' }}</p>
        
        <div *ngIf="hasPreferences()">
          <h5>Preferințe cămin</h5>
          <ol>
            <li *ngFor="let pref of application.preferences | keyvalue">
              {{ pref.value }}
            </li>
          </ol>
        </div>
      </div>

      <div *ngIf="userRole === 3" class="status-update-section">
        <h3>Actualizare Status</h3>
        <div class="form-group">
          <label for="statusSelect">Status nou:</label>
          <select id="statusSelect" class="form-control" [(ngModel)]="selectedStatusId">
            <option *ngFor="let status of statuses" [value]="status.id">{{ status.name }}</option>
          </select>
        </div>
        <div class="form-group">
          <label for="statusComment">Comentariu:</label>
          <textarea id="statusComment" class="form-control" rows="3" [(ngModel)]="statusComment"></textarea>
          <small *ngIf="statusComment.length > 0 && statusComment.length < 5" class="text-danger">Comentariul trebuie să conțină minim 5 caractere</small>
        </div>
        <button 
          [disabled]="updateStatusLoading || statusComment.length < 5" 
          class="btn btn-primary" 
          (click)="updateApplicationStatus()">
          <span *ngIf="updateStatusLoading">Se actualizează...</span>
          <span *ngIf="!updateStatusLoading">Actualizează status</span>
        </button>
      </div>

      <button class="back-button" routerLink="/home">Înapoi</button>
    </div>
  </div>
  
  <footer>
    <br>
    <br>
    <div class="separator"></div>
    <div class="container">
      <div class="row footer">
        <div class="col-md">
          © Universitatea Babeş-Bolyai, 2025, <br>
          toate drepturile rezervate
        </div>
        <div class="col-md">
          Protecția datelor cu caracter personal
        </div>
        <div class="col-md">
          Politica de utilizare a cookies-urilor
        </div>
      </div>
    </div>
    <br>
  </footer>
</div> 